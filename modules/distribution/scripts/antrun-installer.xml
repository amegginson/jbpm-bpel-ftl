<?xml version="1.0" encoding="UTF-8"?>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->

<!-- $Id$ -->

<project basedir="." name="jBPM Installer">

  <!-- ================================================================== -->
  <!-- Setup                                                              -->
  <!-- ================================================================== -->

  <property name="output.dir" value="${basedir}/target" />
  <property name="resources.dir" value="${basedir}/src/main/resources" />
  <property name="filtered.resources.dir" value="${output.dir}/resources" />
  <property name="deploy.artifacts.dir" value="${output.dir}/deploy-artifacts" />


  <!-- ================================================================== -->
  <!-- Initialization                                                     -->
  <!-- ================================================================== -->

  <target name="init">

    <echo />
    <echo message="jboss421.home=${jboss421.home}" />
    <echo message="jboss422.home=${jboss422.home}" />
    <echo message="jboss423.home=${jboss423.home}" />
    <echo message="jboss500.home=${jboss500.home}" />
    <echo message="jboss501.home=${jboss501.home}" />

    <property name="jboss.server.instance" value="default" />

    <property name="jboss421.available.file" value="${jboss421.home}/client/jboss-client.jar" />
    <property name="jboss422.available.file" value="${jboss422.home}/client/jboss-client.jar" />
    <property name="jboss423.available.file" value="${jboss423.home}/client/jboss-client.jar" />
    <property name="jboss500.available.file" value="${jboss500.home}/client/jboss-client.jar" />
    <property name="jboss501.available.file" value="${jboss501.home}/client/jboss-client.jar" />

    <available property="jboss421.available" file="${jboss421.available.file}" />
    <available property="jboss422.available" file="${jboss422.available.file}" />
    <available property="jboss423.available" file="${jboss423.available.file}" />
    <available property="jboss500.available" file="${jboss500.available.file}" />
    <available property="jboss501.available" file="${jboss501.available.file}" />

  </target>

  <!-- ================================================================== -->
  <!-- Distribution                                                       -->
  <!-- ================================================================== -->

  <target name="installer" depends="init" description="Build the binary distritbution">

    <copy todir="${filtered.resources.dir}" filtering="true">
      <fileset dir="${resources.dir}/installer" />
      <filterset>
        <filter token="jboss.home" value="${jboss422.home}" />
      </filterset>
    </copy>

    <!-- Allows us to use the IzPack Ant task, standalone-compiler.jar added to Ant lib -->
    <taskdef name="izpack" classname="com.izforge.izpack.ant.IzPackTask">
      <classpath>
        <pathelement path="${maven.runtime.classpath}" />
      </classpath>
    </taskdef>


    <property name="izpack.temp.dir" value="${output.dir}/izpack-temp" />
    <mkdir dir="${izpack.temp.dir}" />

    <!-- Run installer build -->
    <echo message="Running IzPack to build the installer..." />
    <izpack input="${basedir}/scripts/install-definition.xml" output="${output.dir}/${product.short.name}-${product.version}-install.jar" installerType="standard"
      inheritAll="true" basedir="${izpack.temp.dir}" />

    <!-- Clean working directory -->
    <delete dir="${izpack.temp.dir}" quiet="true" includeemptydirs="true" />
  </target>

</project>
